def create_inputs(utxo):
    if not type(utxo) == type({}):
        return False
    
    txid = utxo['txid'] 
    vout = utxo['vout']
    amount = utxo['amount']
    scriptPubkey = utxo['scriptPubKey']

    #rev txid
    reversed_bytes = bytes.fromhex(txid)[::-1]
    rev_txid = reversed_bytes.hex()
    
    #rev vout
    # Convert vout to a hexadecimal string with 8 digits
    vout_hex = format(vout, '08x')

    # Reverse byte order
    rev_vout = bytes.fromhex(vout_hex)[::-1].hex()
    #print("Reversed vout_hex:", rev_vout)
    
    #start raw tx
    rawtx="04000080" # tx version
    rawtx= rawtx + "85202f89" #version group id
    # number of inputs (1, as we take one utxo from explorer listunspent)
    rawtx = rawtx + "01"
    rawtx= rawtx + rev_txid + rev_vout + "00ffffffff"

    return rawtx, amount


def create_end():
    date = int(time.time())
    nlocktime = bytes.fromhex(format(date, '08x'))[::-1].hex()
    rawtx= nlocktime
    rawtx = rawtx + "000000000000000000000000000000"
    return rawtx

def make_tx_from_scratch(to_pub_amount_dict, total_amount, utxo, from_addr=THIS_NODE_RADDRESS, from_pub=THIS_NODE_PUBKEY, from_priv=THIS_NODE_WIF):
    from_scri = get_script_key(from_pub)

    print( str(utxo['amount']) + ", total_amount: " + str(total_amount) + ", conv: " + str(utxo['confirmations']))
    
    #select utxos
    if utxo['amount'] > (total_amount) and (utxo['confirmations'] > 0):
        print( str(utxo['amount']) + ", total_amount: " + str(total_amount)) 
        #make tx inputs
        rawtx_inputs, amount = create_inputs(utxo)
        rawtx_outputs = create_outputs(utxo, from_scri, to_pub_amount_dict)
        rawtx_end = create_end()
        return rawtx_inputs + rawtx_outputs + rawtx_end, amount*100000000
    
    raise Exception("UTXO not usable")
    return  "No usable utxo was found", 0


#to_pub amount dict utxo, split_count, split_total_satoshis, split_value_sats, from_hash, to_pub=THIS_NODE_PUBKEY
def create_outputs(utxo, from_hash, to_pub_amount_dict):
    rawtx = ""
    n_outputs = len(to_pub_amount_dict)

    if type(to_pub_amount_dict) == type([]):
       n_outputs = n_outputs*len(to_pub_amount_dict[0]) 

    if  n_outputs < 252:
        oc = n_outputs + 1
        outputCount = format(oc, '02x')
        rawtx=rawtx + outputCount
        total_amount = 0

        if type(to_pub_amount_dict) == type([]):
            for dict in to_pub_amount_dict:
                for key, value  in dict.items():
                    amount = bytes.fromhex(format(value, '016x'))[::-1].hex()
                    rawtx = rawtx + amount
                    rawtx = rawtx + "2321" + key + "ac"
                    total_amount += value
        else:
            for key, value  in to_pub_amount_dict.items():
                amount = bytes.fromhex(format(value, '016x'))[::-1].hex()
                rawtx = rawtx + amount
                rawtx = rawtx + "2321" + key + "ac"
                total_amount += value

        change = utxo['satoshis'] - total_amount
        print("change: " + str(change))
        value = bytes.fromhex(format(change, '016x'))[::-1].hex()
        rawtx=rawtx + value

        rawtx = rawtx + "1976a914" + from_hash + "88ac"
        return rawtx

    else:
        print("cannot")
        return False